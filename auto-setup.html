<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Auto Admin Setup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 50px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 32px;
        }

        .subtitle {
            color: #718096;
            margin-bottom: 40px;
            font-size: 16px;
        }

        .status {
            background: #f7fafc;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            min-height: 200px;
        }

        .status h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            font-size: 16px;
        }

        .step .icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
        }

        .loading {
            background: #bee3f8;
            color: #2c5282;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
        }

        .error {
            background: #fed7d7;
            color: #742a2a;
        }

        .credentials {
            background: #2d3748;
            color: #68d391;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            font-size: 18px;
        }

        .credentials p {
            margin: 10px 0;
        }

        .btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(56, 239, 125, 0.4);
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üöÄ Auto Admin Setup</h1>
        <p class="subtitle">Automated admin creation and testing</p>

        <div class="status" id="status">
            <h2>Ready to Start</h2>
            <p>Click the button below to automatically:</p>
            <ul style="text-align: left; margin: 20px 40px; line-height: 2;">
                <li>‚úÖ Create admin user in Firebase Auth</li>
                <li>‚úÖ Create admin document in Firestore</li>
                <li>‚úÖ Test login credentials</li>
                <li>‚úÖ Redirect to dashboard</li>
            </ul>
            <button class="btn" onclick="autoSetup()">Start Auto Setup</button>
        </div>

        <div class="credentials hidden" id="credentials">
            <p><strong>Email:</strong> admin@admin.com</p>
            <p><strong>Password:</strong> Admin@123456</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDh_Mc7ySjYBErcU9bfrTnIgQ_mrHdWZac",
            authDomain: "admin-904d8.firebaseapp.com",
            projectId: "admin-904d8",
            storageBucket: "admin-904d8.firebasestorage.app",
            messagingSenderId: "681702729140",
            appId: "1:681702729140:web:5ef1bdd25ca25199f1bee1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const email = 'admin@admin.com';
        const password = 'Admin@123456';

        function updateStatus(html) {
            document.getElementById('status').innerHTML = html;
        }

        function showStep(text, type = 'loading') {
            return `<div class="step"><div class="icon ${type}">${type === 'loading' ? '‚è≥' : type === 'success' ? '‚úÖ' : '‚ùå'}</div>${text}</div>`;
        }

        window.autoSetup = async function () {
            const statusDiv = document.getElementById('status');
            const credsDiv = document.getElementById('credentials');

            let steps = '<h2>Setting Up...</h2>';
            updateStatus(steps + '<div class="spinner"></div>');

            try {
                // Step 1: Create user
                steps += showStep('Creating Firebase Auth user...', 'loading');
                updateStatus(steps);

                let userCredential;
                let userId;

                try {
                    userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    userId = userCredential.user.uid;
                    steps = steps.replace('Creating Firebase Auth user...', 'Firebase Auth user created! UID: ' + userId.substring(0, 8) + '...');
                    steps = steps.replace('loading', 'success');
                    updateStatus(steps);
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        steps = steps.replace('Creating Firebase Auth user...', 'User already exists (that\'s OK!)');
                        steps = steps.replace('loading', 'success');
                        updateStatus(steps);

                        // Try to sign in to get the UID
                        const tempCred = await signInWithEmailAndPassword(auth, email, password);
                        userId = tempCred.user.uid;
                        await signOut(auth);
                    } else {
                        throw error;
                    }
                }

                // Step 2: Create Firestore document
                steps += showStep('Creating Firestore admin document...', 'loading');
                updateStatus(steps);

                await setDoc(doc(db, 'users', userId), {
                    role: 'admin',
                    email: email,
                    createdAt: new Date()
                }, { merge: true });

                steps = steps.replace('Creating Firestore admin document...', 'Firestore admin document created!');
                steps = steps.replace(/loading(?!.*loading)/, 'success');
                updateStatus(steps);

                // Step 3: Test login
                steps += showStep('Testing login credentials...', 'loading');
                updateStatus(steps);

                const testCred = await signInWithEmailAndPassword(auth, email, password);

                // Verify admin role
                const userDoc = await getDoc(doc(db, 'users', testCred.user.uid));
                if (!userDoc.exists() || userDoc.data().role !== 'admin') {
                    throw new Error('Admin role not set correctly');
                }

                steps = steps.replace('Testing login credentials...', 'Login test successful!');
                steps = steps.replace(/loading(?!.*loading)/, 'success');
                updateStatus(steps);

                // Success!
                steps += '<br><br><h2 style="color: #38a169;">üéâ Setup Complete!</h2>';
                steps += '<p style="margin: 20px 0;">Redirecting to login page in 3 seconds...</p>';
                updateStatus(steps);

                credsDiv.classList.remove('hidden');

                // Redirect to login
                setTimeout(() => {
                    window.location.href = 'http://localhost:3000/login';
                }, 3000);

            } catch (error) {
                console.error('Setup error:', error);
                steps += showStep('Error: ' + error.message, 'error');
                steps += '<br><br><button class="btn" onclick="location.reload()">Try Again</button>';
                updateStatus(steps);
            }
        };

        // Auto-start on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                const btn = document.querySelector('.btn');
                if (btn) {
                    btn.click();
                }
            }, 1000);
        });
    </script>
</body>

</html>